{% extends "style/base_public.html" %}
{% load static %}

{% block title %}Recibo - Pedido #{{ item.pedido.pk }}{% endblock %}

{% block body %}
<section class="card" style="max-width:800px;margin:16px auto;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div>
      <h2>{{ empresa.razao_social }}</h2>
      <div style="font-size:0.9rem;color:#555;">CNPJ: {{ empresa.cnpj }}</div>
      {% if empresa.telefone %}<div style="font-size:0.9rem;color:#555;">Tel: {{ empresa.telefone }}</div>{% endif %}
    </div>
    <div>
      {% if empresa.foto %}
        <img src="{{ empresa.foto.url }}" alt="Logo" style="height:80px; object-fit:contain;">
      {% endif %}
    </div>
  </div>

  <hr style="margin:12px 0;">

  <div style="display:flex;gap:12px;">
    <div style="flex:1;">
      <h3>Recibo de Retirada — Pedido #{{ item.pedido.pk }}</h3>
      <div>Data do pedido: {{ item.pedido.criado_em|date:"Y-m-d H:i" }}</div>
      <div>Cliente: {{ cliente.username }}{% if cliente.email %} · {{ cliente.email }}{% endif %}</div>
    </div>
    <div style="width:180px; text-align:right;">
      <div style="font-weight:700;">Total do pedido:</div>
      <div style="font-size:1.1rem;">R$ {{ item.pedido.total_bruto|default:item.total|floatformat:2 }}</div>
    </div>
  </div>

  <hr style="margin:12px 0;">

  <div style="display:flex;gap:12px;align-items:center;">
    <div style="width:120px; height:120px; border:1px solid #eee; display:flex; align-items:center; justify-content:center;">
      {% if item.produto.imagem %}
      <img src="{{ item.produto.imagem.url }}" alt="{{ item.produto.nome }}" style="max-height:110px; max-width:110px; object-fit:contain;">
      {% else %}
      <div style="color:#999; font-size:0.9rem;">Sem imagem</div>
      {% endif %}
    </div>
    <div style="flex:1;">
      <h4 style="margin:0;">{{ item.produto.nome }}</h4>
      <div>Quantidade: {{ item.quantidade }}</div>
      <div>Preço unitário: R$ {{ item.preco_unitario|floatformat:2 }}</div>
      <div style="font-weight:700; margin-top:8px;">Total item: R$ {{ item.total|floatformat:2 }}</div>
      {% if item.percentual_doacao %}
        <div style="color:#2d6a4f;">Doação: {{ item.percentual_doacao }}% → R$ {{ item.valor_doacao|floatformat:2 }}</div>
      {% endif %}
    </div>
  </div>

  {% if ong %}
    <hr style="margin:12px 0;">
    <div>
      <h4>ONG beneficiada</h4>
      <div>{{ ong.nome_fantasia }} — CNPJ: {{ ong.cnpj }}</div>
      {% if ong.foto %}<img src="{{ ong.foto.url }}" alt="ONG" style="height:60px; object-fit:contain; margin-top:6px;">{% endif %}
    </div>
  {% endif %}

  <div style="margin-top:18px;">
    <p>Declaro que recebi/retirei o produto descrito acima nas condições apresentadas.</p>

    <div style="display:flex; gap:24px; margin-top:32px;">
      <div style="flex:1; text-align:center;">
        <div style="border-top:1px solid #000; padding-top:8px;">Assinatura da Empresa</div>
        <div style="font-size:0.9rem; color:#666;">{{ empresa.razao_social }}</div>
      </div>
      <div style="flex:1; text-align:center;">
        <div style="border-top:1px solid #000; padding-top:8px;">Assinatura do Cliente</div>
        <div style="font-size:0.9rem; color:#666;">{{ cliente.username }}</div>
      </div>
    </div>
  </div>

  <div style="margin-top:18px; display:flex; justify-content:flex-end; gap:8px;">
    <button class="btn" onclick="window.close();">Fechar</button>
    <button class="btn btn-primary" onclick="window.print();">Imprimir / Salvar PDF</button>
  </div>

  <style>
    @media print {
      .btn { display:none !important; }
      body { background: white }
    }
  </style>
</section>
{% endblock %}
