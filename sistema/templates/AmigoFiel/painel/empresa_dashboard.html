{% extends "style/base_public.html" %}
{% load static %}

{% block title %}Painel ‚Äî {{ perfil.razao_social }}{% endblock %}

{% block body %}
<section class="hero">
  <div>
    <h1>Painel da Empresa</h1>
    <p class="muted">
      {{ perfil.razao_social }} ¬∑ @{{ perfil.user.username }}
      {% if perfil.cidade %} ¬∑ üèôÔ∏è {{ perfil.cidade }}{% endif %}
    </p>
    <div class="actions" style="margin-top:8px">
      <a class="btn btn-primary" href="{% url 'amigofiel:produto-novo' %}">‚ûï Cadastrar produto</a>
      <a class="btn btn-secondary" href="{% url 'amigofiel:perfil-empresa' handle=perfil.user.username %}">Ver perfil p√∫blico</a>
    </div>
  </div>
</section>

<section class="grid" style="margin-top:10px">
  <article class="mini-card">
    <h3>Produtos</h3>
    <p class="muted">Ativos: <strong>{{ met.ativos }}</strong></p>
    <p class="muted">Total: <strong>{{ met.total_produtos }}</strong></p>
  </article>

  <article class="mini-card">
    <h3>Vendas</h3>
    <p class="muted">Itens vendidos: <strong>{{ met.itens_vendidos|default:"‚Äî" }}</strong></p>
    <p class="muted">Total vendido: <strong>R$ {{ met.total_vendas|default:"‚Äî" }}</strong></p>
    <p class="muted">Total doado a ONGs: <strong>R$ {{ met.total_doacao|default:"‚Äî" }}</strong></p>
  </article>
</section>

<section class="card" style="margin-top:14px">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <h2>Produtos recentes</h2>
    <div class="actions" style="display:flex; gap:8px; align-items:center">
      <a class="btn btn-secondary" href="{% url 'amigofiel:listar-produtos' %}?q=@{{ perfil.user.username }}">Ver listagem</a>
      <a class="btn btn-primary" href="{% url 'amigofiel:produto-novo' %}">Novo produto</a>
    </div>
  </div>

  {% if produtos %}
    <div class="products-grid">
      {% for prod in produtos %}
        <article class="mini-card">
          <img class="thumb" src="{% if prod.imagem %}{{ prod.imagem.url }}{% else %}{% static 'img/defaults/produto.png' %}{% endif %}" alt="{{ prod.nome }}">
          <h3>{{ prod.nome }}</h3>
          <p class="muted">{{ prod.descricao|default:"Sem descri√ß√£o" |truncatechars:80 }}</p>
          <p><strong>R$ {{ prod.preco }}</strong> ¬∑ Estoque: {{ prod.estoque }}</p>
          <div class="actions">
            {% if prod.slug %}
              <a class="btn btn-primary" href="{% url 'amigofiel:produto-detalhe' empresa_handle=perfil.user.username produto_slug=prod.slug %}">Abrir</a>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Nenhum produto cadastrado.</p>
  {% endif %}
</section>
{% endblock %}

{% block extra_js %}
<style>
  /* Responsive 4-column grid for products */
  .products-grid {
    display: grid;
    gap: 12px;
    margin-top: 10px;
    grid-template-columns: repeat(1, minmax(0, 1fr));
  }
  @media (min-width: 640px) { /* ~sm */
    .products-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 900px) { /* ~md */
    .products-grid { grid-template-columns: repeat(3, 1fr); }
  }
  @media (min-width: 1200px) { /* ~lg */
    .products-grid { grid-template-columns: repeat(4, 1fr); }
  }

  /* Consistent card layout */
  .products-grid .mini-card {
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  .products-grid .mini-card .thumb {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #eee;
  }
  .products-grid .mini-card h3 {
    margin: 8px 0 4px;
    font-size: 1rem;
  }
  .products-grid .mini-card p.muted {
    margin: 0 0 8px;
  }
  .products-grid .mini-card .actions {
    margin-top: auto;
  }
</style>
{% endblock %}
