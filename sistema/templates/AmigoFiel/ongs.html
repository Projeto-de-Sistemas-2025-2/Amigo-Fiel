{% extends "style/base_public.html" %}
{% load static %}

{% block title %}ONGs — Amigo Fiel{% endblock %}

{% block body %}
  <!-- Hero -->
  <section class="hero center">
    <div class="brand">
      <div class="logo">🐾</div>
      <h1 class="h1">ONGs cadastradas</h1>
      <p class="muted">Encontre e apoie organizações parceiras</p>
    </div>
  </section>

  <!-- Filtros -->
  <section class="card">
    <form method="get" class="grid grid-1 grid-md-2">
      <div class="input-wrap">
        <label for="q">Buscar por nome ou @username</label>
        <input id="q" name="q" type="text" class="input" value="{{ q }}" placeholder="Ex.: Patinhas Felizes">
      </div>

      <div class="input-wrap">
        <label for="cidade">Filtrar por cidade</label>
        <input id="cidade" name="cidade" type="text" class="input" value="{{ cidade }}" placeholder="Ex.: Palmas">
      </div>

      <div class="actions" style="grid-column:1/-1;">
        <button class="btn btn-primary" type="submit">Buscar</button>
        <a href="{% url 'amigofiel:listar-ongs' %}" class="btn btn-secondary">Limpar</a>
      </div>
    </form>

    <div class="actions">
      <div class="line"></div>
      <span class="muted">ou</span>
      <div class="line"></div>
    </div>
    <p class="center muted">Deixe os campos vazios para ver todas as ONGs.</p>
  </section>

  <!-- Lista -->
  {% if ongs %}
    <section class="grid grid-1 grid-md-2 grid-lg-4">
      {% for ong in ongs %}
        {% url 'amigofiel:perfil-ong' handle=ong.user.username as perfil_url %}
        <article class="mini-card">
          {% if ong.foto %}
            <a href="{{ perfil_url }}" aria-label="Perfil da ONG {{ ong.nome_fantasia }}">
              <img class="fluid-img" src="{{ ong.foto.url }}" alt="Logo da ONG {{ ong.nome_fantasia }}" loading="lazy" decoding="async">
            </a>
          {% endif %}

          <h3 class="h2" style="margin:6px 0;">
            <a href="{{ perfil_url }}" style="text-decoration:none; color:inherit;">
              {{ ong.nome_fantasia }}
            </a>
          </h3>

          <p class="muted">{% if ong.cidade %}🏙️ {{ ong.cidade }}{% else %}—{% endif %}</p>
          <p>🐾 {{ ong.qtd_pets }} pet{{ ong.qtd_pets|pluralize }}</p>

          <div class="actions">
            <a href="{{ perfil_url }}" class="btn btn-primary">Ver perfil</a>
            {% if ong.site %}
              <a href="{{ ong.site }}" target="_blank" rel="noopener" class="btn btn-secondary">Visitar site</a>
            {% endif %}
            {% if ong.cidade %}
              <a href="?cidade={{ ong.cidade|urlencode }}" class="btn btn-secondary">ONGs em {{ ong.cidade }}</a>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </section>

    {% if is_paginated %}
      <nav class="actions" aria-label="Paginação">
        {% if page_obj.has_previous %}
          <a class="btn btn-secondary"
             href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if cidade %}&cidade={{ cidade|urlencode }}{% endif %}">Anterior</a>
        {% endif %}
        <span class="muted">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a class="btn btn-secondary"
             href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if cidade %}&cidade={{ cidade|urlencode }}{% endif %}">Próxima</a>
        {% endif %}
      </nav>
    {% endif %}
  {% else %}
    <section class="card center">
      <p class="muted">Nenhuma ONG encontrada para os filtros informados.</p>
    </section>
  {% endif %}
{% endblock %}
